import{u as C,a as U,r as _,b as A,o as n,c as p,d as e,t as y,k as s,l as D,e as g,i as P,w as i,v as u,j as m}from"./index-9J9Lotk-.js";const V={class:"profile"},j={class:"intro"},x={class:"image"},B=["src"],$={key:2},E=e("label",{for:"upload",class:"change-pic"},"Change Picture",-1),S={class:"edition"},T=e("h1",null,"Edit Profile",-1),F={class:"error"},I={key:0},N=e("label",{for:"email"},"Email:",-1),L=e("label",{for:"username"},"username:",-1),M=e("label",{for:"password"},"New Password:",-1),O=e("label",{for:"birthday"},"Birthday:",-1),H=e("label",{for:"country"},"Country:",-1),J=e("button",{type:"submit",class:"change-pic"},"Update Profile",-1),R=e("h2",null,"Log Out",-1),W=e("p",null," If you log out, you can access your account, profile, Todos and data at any time after logging in again. ",-1),q=e("h2",null,"Delete Account",-1),z=e("p",null," When you delete your account, your profile, Todos, Data will be removed. And you will not be able to sign in until you create a new account. If you still want to delete the account, click on delete account ",-1),Q={__name:"user-profile",setup(G){const h=C(),t=U(),d=_(null),c=_(null),f=async()=>{try{let a=new FormData;a.append("username",t.user.username),a.append("email",t.user.email),t.user.country&&a.append("country",t.user.country),t.user.birthday&&a.append("birthday",t.user.birthday),t.user.pic&&typeof t.user.pic=="object"&&a.append("profile_picture",t.user.pic),d.value&&a.append("password",d.value);const o=await m.patch(`/api/users/${t.user.id}/`,a,{headers:{"Content-Type":"multipart/form-data"}});o.status===200?t.setUser({id:o.data.id,username:o.data.username,email:o.data.email,pic:o.data.profile_picture,birthday:o.data.birthday,country:o.data.country,join:o.data.join_date}):alert("Failed to update profile.")}catch(a){let o=a.response.data;if(console.log(o),o){for(const r in o)if(Array.isArray(o[r])&&o[r].length>0){c.value=`${r} :${o[r][0]}`;break}}}},b=a=>{const o=a.target.files[0];t.user.pic=o,f()},v=()=>{confirm("Are you sure you want to delete your account?")&&m.delete(`/api/users/${t.user.id}/`).then(()=>{localStorage.clear(),t.setUser(null),h.push("/"),window.location.href="/"}).catch(a=>{console.error("Error deleting account:",a),c.value="Failed to delete your account. Please try again later."})},w=()=>{confirm("Are you sure you want to log out?")&&(t.setUser(null),localStorage.clear(),h.push("/"),window.location.href="/")},k=async()=>{try{const a={profile_picture:null};t.user.pic=null,await m.patch(`/api/users/${t.user.id}/`,a,{headers:{"Content-Type":"application/json"}})}catch(a){console.log(a)}};return(a,o)=>{const r=A("font-awesome-icon");return n(),p("div",V,[e("div",j,[e("h1",null,"Hello "+y(s(t).user.username),1),e("div",x,[s(t).user.pic!==null?(n(),D(r,{key:0,icon:"fa-regular fa-trash-can",class:"trash",onClick:o[0]||(o[0]=l=>k())})):g("",!0),s(t).user.pic!==null?(n(),p("img",{key:1,src:s(t).user.pic,alt:"profile picture"},null,8,B)):(n(),p("span",$,y(s(t).user.username[0].toUpperCase()),1))]),E,e("input",{id:"upload",type:"file",onChange:b,style:{display:"none"},accept:"image/*"},null,32),e("p",null,"Join Date: "+y(s(t).user.join),1)]),e("div",S,[T,e("div",F,[c.value?(n(),p("p",I,y(c.value),1)):g("",!0)]),e("form",{onSubmit:P(f,["prevent"])},[e("div",null,[N,i(e("input",{placeholder:"Email",type:"email",id:"email","onUpdate:modelValue":o[1]||(o[1]=l=>s(t).user.email=l)},null,512),[[u,s(t).user.email]])]),e("div",null,[L,i(e("input",{placeholder:"Username",type:"text",id:"username","onUpdate:modelValue":o[2]||(o[2]=l=>s(t).user.username=l)},null,512),[[u,s(t).user.username]])]),e("div",null,[M,i(e("input",{placeholder:"Password",type:"password",id:"password","onUpdate:modelValue":o[3]||(o[3]=l=>d.value=l)},null,512),[[u,d.value]])]),e("div",null,[O,i(e("input",{placeholder:"Birthday",type:"birthday",id:"birthday","onUpdate:modelValue":o[4]||(o[4]=l=>s(t).user.birthday=l)},null,512),[[u,s(t).user.birthday]])]),e("div",null,[H,i(e("input",{placeholder:"Country",type:"text",id:"country","onUpdate:modelValue":o[5]||(o[5]=l=>s(t).user.country=l)},null,512),[[u,s(t).user.country]])]),J],32),e("div",{class:"logout"},[R,W,e("button",{onClick:w},"Log Out")]),e("div",{class:"delete"},[q,z,e("button",{onClick:v},"Delete Account")])])])}}};export{Q as default};
